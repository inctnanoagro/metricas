{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://inct-nanoagro.example/schemas/producoes_v2.schema.json",
  "title": "Lattes Productions Collection Schema (INCT NanoAgro) - v2",
  "description": "Schema for validating parsed Lattes production items/fixtures by type (parse_fixture output)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "tipo_producao",
    "source_file",
    "items"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "2.0.0",
      "description": "Schema version identifier"
    },

    "tipo_producao": {
      "type": "string",
      "description": "Type of production - derived from source filename"
    },

    "source_file": {
      "type": "string",
      "description": "Source HTML filename for audit trail"
    },

    "extraction_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of extraction"
    },

    "items": {
      "type": "array",
      "description": "List of parsed production items",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "numero_item",
          "raw"
        ],
        "properties": {
          "numero_item": {
            "type": "integer",
            "minimum": 1,
            "description": "Ordinal number from Lattes (1., 2., 3., etc)"
          },

          "raw": {
            "type": "string",
            "description": "Raw text extracted from span.transform for audit"
          },

          "autores": {
            "type": ["string", "null"],
            "description": "Authors semicolon-separated, normalized"
          },

          "titulo": {
            "type": ["string", "null"],
            "description": "Title when identifiable"
          },

          "ano": {
            "type": ["integer", "null"],
            "minimum": 1800,
            "maximum": 2100,
            "description": "Publication year"
          },

          "mes": {
            "type": ["string", "null"],
            "description": "Month abbreviation (jan., fev., mar., etc) when available"
          },

          "veiculo": {
            "type": ["string", "null"],
            "description": "Journal/newspaper/venue name"
          },

          "volume": {
            "type": ["string", "null"],
            "description": "Volume information"
          },

          "paginas": {
            "type": ["string", "null"],
            "description": "Page range or page information"
          },

          "doi": {
            "type": ["string", "null"],
            "description": "DOI identifier without URL prefix"
          },

          "isbn": {
            "type": ["string", "null"],
            "description": "ISBN for books/chapters"
          },

          "livro": {
            "type": ["string", "null"],
            "description": "Book name for chapters"
          },

          "editora": {
            "type": ["string", "null"],
            "description": "Publisher name"
          },

          "edicao": {
            "type": ["string", "null"],
            "description": "Edition information"
          },

          "local": {
            "type": ["string", "null"],
            "description": "Publication location/city"
          },

          "evento": {
            "type": ["string", "null"],
            "description": "Event name for congress papers"
          },

          "instituicao": {
            "type": ["string", "null"],
            "description": "Institution for thesis/dissertations"
          },

          "orientador": {
            "type": ["string", "null"],
            "description": "Advisor name for thesis/dissertations"
          },

          "tipo_orientacao": {
            "type": ["string", "null"],
            "description": "Type of supervision/participation"
          },

          "natureza": {
            "type": ["string", "null"],
            "description": "Nature/type of work"
          },

          "issn": {
            "type": ["string", "null"],
            "description": "ISSN for journals"
          },

          "url": {
            "type": ["string", "null"],
            "description": "URL if available"
          },

          "html_snippet": {
            "type": ["string", "null"],
            "description": "First 500 chars of HTML for debugging"
          },

          "fingerprint_sha1": {
            "type": ["string", "null"],
            "pattern": "^[a-f0-9]{40}$",
            "description": "SHA1 hash of raw text for deduplication"
          },

          "parse_warnings": {
            "type": ["array", "null"],
            "items": {
              "type": "string"
            },
            "description": "Warnings during parsing"
          }
        }
      }
    },

    "parse_metadata": {
      "type": "object",
      "additionalProperties": false,
      "description": "Metadata about the parsing process",
      "properties": {
        "parser_version": {
          "type": "string",
          "description": "Parser version used"
        },
        "total_items": {
          "type": "integer",
          "minimum": 0,
          "description": "Total items parsed"
        },
        "parse_errors": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of items that failed to parse"
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Global parsing warnings"
        }
      }
    }
  }
}
